#
# key/value type configure.
# the configure file is created by encoder customizer, end-user isn't allowed to modify the configure file directly.
# end-user can modify the configure item by web ui or command line tools.
# <type description>value</type> style value is modifiable.
# types: select option ipaddr number string
#
[server]
# http streaming server
httpstreaming = <ipaddr http streaming ip address>0.0.0.0:20129</ipaddr>

# http managment server
httpmgmt = <ipaddr http management ip address>0.0.0.0:20128</ipaddr> # test regex <ipaddr>value</ipaddr>

# log dirctory
logdir = /var/log/itvencoder

# pid file path
pidfile = /var/run/itvencoder.pid

[channel]
test = {
    onboot = <option start on boot>yes</option>

    # source pipeline defination
    source = {
        textoverlay = {
            property = {
                text = iTVEncoder-0.2.0
                valign = top
                halign = right
            }
            # option define option element
            option = <option if textoverlay>yes</option>
        }

        # element can be customized by elemment(property=vlue, ...)
        bins = {
            audiosrc = {
                description = audiotestsrc ! appsink name=audio
                option = <option audiosrc?>yes</option>
            }
            videosrc = {
                description = videotestsrc ! textoverlay ! clockoverlay ! timeoverlay ! appsink name=video
                option = <option videosrc?>yes</option>
            }
        }
    }

    # encoder pipeline defination
    encoder = {
        encoder1 = {
            videoscale = {
                caps = video/x-raw-yuv,width=<number>720</number>,height=<number>576</number>
            }

            # x264 encoder element
            x264enc = {
                property = {
                        bitrate = <number h.264 encoder bitrate>1500</number>
                        byte-stream = true
                        threads = <number encoder theads number>4</number>
                        bframes = <number b frame number>3</number>
                        profile = <string encoder profile>high</string>
                }
            }

            # faac audio encoder
            faac = {
                property = {
                    name = faac
                    outputformat = 1
                }
            }

            # mpeg2 ts mux
            mpegtsmux = {
                property = {
                    name = muxer
                }
            }

            # flv mux
            flvmux = {
                property = {
                    name = muxer
                }
            }

            # mux select
            mux = <select[mpegtsmux, flv] select mux>mpegtsmux</select>

            bins = {
                videoenc = {
                    description = appsrc name=video ! videoscale ! x264enc ! muxer
                }
                audioenc = {
                    description = appsrc name=audio ! faac ! mpegtsmux ! muxer
                }
                muxer = {
                    description = mux ! appsink name=output
                }
            }

            httpstreaming = <option>yes</option>
            udpstreaming = <ipaddr udp output address>224.1.1.1:1111</ipaddr>
        }

        encoder2 = {
            bins = {
                videoenc = {
                    description = appsrc name=video ! videoscale ! vidoecodec ! mux ! appsink name=output
                }
                audioenc = {
                    description = appsrc name=audio ! faac ! mpegtsmux
                }
            }

            httpstreaming = <option http streaming support>yes</option>
            udpstreaming = <ipaddr udp streaming address>224.1.1.2:1111</ipaddr>
        }
    }
}

mpegtsoverip = {
    onboot = no

    # source pipeline defination
    source = {
        textoverlay = {
            property = {
                text = iTVEncoder-0.2.0
                valign = top
                halign = right
            }
            # option define option element
            option = <option if textoverlay>yes</option>
        }

        udpsrc = {
            property = {
                uri = <string udp source ip address>udp://127.0.0.1:1234</string>
            }
        }

        # element can be customized by elemment(property=vlue, ...)
        bins = {
            mpegtsdemuxer = {
                # dont link a sometimes pad directly.
                description = udpsrc ! mpegtsdemux name=demuxer
            }
            english = {
                description = demuxer.audio_026d ! mad ! appsink name=english
            }
            thai = {
                description = demuxer.audio_0271 ! appsink name=thai
            }
            videosrc = {
                description = demuxer.video_0201 ! appsink name=video
            }
            subtitle = {
                description = demuxer.private_044f ! appsink name=subtitle
            }
        }
    }

    # encoder pipeline defination
    encoder = {
        encoder1 = {
            videoscale = {
                caps = video/x-raw-yuv,width=<number>720</number>,height=<number>576</number>
            }

            # x264 encoder element
            x264enc = {
                property = {
                    name = x264enc
                    bitrate = <number h.264 encoder bitrate>1500</number>
                    byte-stream = true
                    threads = <number encoder theads number>4</number>
                    bframes = <number b frame number>3</number>
                    profile = <string encoder profile>high</string>
                }
            }

            # faac audio encoder
            faac = {
                property = {
                    name = faac
                    outputformat = 1
                }
            }

            # mpeg2 ts mux
            mpegtsmux = {
                property = {
                    name = muxer
                }
            }

            # flv mux
            flvmux = {
                property = {
                    name = muxer
                }
            }

            # mux select
            mux = <select[mpegtsmux, flv] select mux>mpegtsmux</select>

            bins = {
                videoenc = {
                    description = appsrc name=video ! videoscale ! x264enc ! mux ! appsink name=output
                }
                audioenc = {
                    appsrc name=audio ! faac ! mpegtsmux
                }
            }
            httpstreaming = <option>yes</option>
            udpstreaming = <ipaddr udp output address>224.1.1.1:1111</ipaddr>
        }

        encoder2 = {
            bins = {
                videoenc = {
                    description = appsrc name=video ! videoscale ! vidoecodec ! mpegtsmux ! appsink name=output
                }
                audioenc = {
                    description = appsrc name=audio ! faac ! mpegtsmux
                }
            }
            httpstreaming = <option http streaming support>yes</option>
            udpstreaming = <ipaddr udp streaming address>224.1.1.2:1111</ipaddr>
        }
    }
}
